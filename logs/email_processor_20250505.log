2025-05-05 13:09:52,805 [INFO] email_processor: Logging initialized at INFO level
2025-05-05 13:09:52,805 [INFO] email_processor: === Email Processing System Starting ===
2025-05-05 13:09:52,805 [INFO] email_processor: Settings:
2025-05-05 13:09:52,805 [INFO] email_processor: - MAIL_SEND_ENABLED: False
2025-05-05 13:09:52,805 [INFO] email_processor: - SFTP_ENABLED: True
2025-05-05 13:09:52,805 [INFO] email_processor: - BATCH_SIZE: 125
2025-05-05 13:09:52,805 [INFO] email_processor: - BATCH_INTERVAL: 600 seconds
2025-05-05 13:09:52,805 [INFO] email_processor: Cleaning up existing failed batches
2025-05-05 13:09:52,829 [INFO] email_processor: No failed batches to clean up
2025-05-05 13:09:52,829 [INFO] email_processor: Starting retry of failed batches
2025-05-05 13:09:52,832 [INFO] email_processor: No failed batches to retry
2025-05-05 13:09:52,832 [INFO] email_processor: Starting main email processing loop
2025-05-05 13:09:52,832 [INFO] email_processor: Starting email batch processor (batch size: 125, interval: 600s)
2025-05-05 13:09:52,832 [INFO] email_processor: Mail sending is DISABLED
2025-05-05 13:09:52,832 [INFO] email_processor: SFTP export is ENABLED
2025-05-05 13:09:52,832 [INFO] email_processor: Cleaning up existing failed batches
2025-05-05 13:09:52,837 [INFO] email_processor: No failed batches to clean up
2025-05-05 13:09:52,837 [INFO] email_processor: Starting batch at 2025-05-05T13:09:52.837326
2025-05-05 13:09:52,837 [INFO] email_processor: Starting retry of failed batches
2025-05-05 13:09:52,837 [INFO] email_processor: No failed batches to retry
2025-05-05 13:09:52,837 [INFO] email_processor: Starting new batch processor run
2025-05-05 13:09:52,840 [INFO] email_processor: Created new batch run in PostgreSQL with ID: ac681f37-2f28-48ea-9e49-c21150bd22f0
2025-05-05 13:09:52,840 [INFO] email_processor: Created new batch with ID: ac681f37-2f28-48ea-9e49-c21150bd22f0
2025-05-05 13:09:52,851 [INFO] email_processor: MongoDB indexes setup complete
2025-05-05 13:09:52,851 [INFO] email_processor: Connected to MongoDB: db=email_classification, collection=emails
2025-05-05 13:09:52,863 [INFO] email_processor: Created missing batch record in MongoDB: ac681f37-2f28-48ea-9e49-c21150bd22f0
2025-05-05 13:09:52,863 [INFO] email_processor: Processing batch ac681f37-2f28-48ea-9e49-c21150bd22f0 (max 125)
2025-05-05 13:09:52,870 [INFO] email_processor: Using batch size from environment: 125
2025-05-05 13:09:53,161 [INFO] email_processor: No valid refresh token found; initiating interactive auth flow.
2025-05-05 13:09:53,283 [INFO] email_processor: Browser opened for authentication. Please login and authorize the app.
2025-05-05 13:10:28,809 [INFO] email_processor: Batch processor stopped by user
2025-05-05 13:10:28,832 [INFO] email_processor: No draft emails found for batch ac681f37-2f28-48ea-9e49-c21150bd22f0
2025-05-05 13:10:28,845 [INFO] email_processor: Updated batch ac681f37-2f28-48ea-9e49-c21150bd22f0 with status: success
2025-05-05 13:10:28,846 [INFO] email_processor: No emails for batch ac681f37-2f28-48ea-9e49-c21150bd22f0 to export
2025-05-05 13:10:28,847 [INFO] email_processor: Batch complete. Next batch in 564.0 seconds
2025-05-05 13:10:32,870 [INFO] email_processor: System shutdown requested (KeyboardInterrupt)
2025-05-05 13:10:32,870 [INFO] email_processor: === Email Processing System Shutdown ===
2025-05-05 14:48:05,486 [INFO] email_processor: Logging initialized at INFO level
2025-05-05 14:48:05,486 [INFO] email_processor: === Email Processing System Starting ===
2025-05-05 14:48:05,487 [INFO] email_processor: Settings:
2025-05-05 14:48:05,487 [INFO] email_processor: - MAIL_SEND_ENABLED: False
2025-05-05 14:48:05,487 [INFO] email_processor: - SFTP_ENABLED: True
2025-05-05 14:48:05,487 [INFO] email_processor: - BATCH_SIZE: 125
2025-05-05 14:48:05,487 [INFO] email_processor: - BATCH_INTERVAL: 600 seconds
2025-05-05 14:48:05,487 [INFO] email_processor: Cleaning up existing failed batches
2025-05-05 14:48:05,502 [INFO] email_processor: No failed batches to clean up
2025-05-05 14:48:05,502 [INFO] email_processor: Starting retry of failed batches
2025-05-05 14:48:05,509 [INFO] email_processor: No failed batches to retry
2025-05-05 14:48:05,509 [INFO] email_processor: Starting main email processing loop
2025-05-05 14:48:05,509 [INFO] email_processor: Starting email batch processor (batch size: 125, interval: 600s)
2025-05-05 14:48:05,509 [INFO] email_processor: Mail sending is DISABLED
2025-05-05 14:48:05,509 [INFO] email_processor: SFTP export is ENABLED
2025-05-05 14:48:05,509 [INFO] email_processor: Cleaning up existing failed batches
2025-05-05 14:48:05,513 [INFO] email_processor: No failed batches to clean up
2025-05-05 14:48:05,513 [INFO] email_processor: Starting batch at 2025-05-05T14:48:05.513944
2025-05-05 14:48:05,514 [INFO] email_processor: Starting retry of failed batches
2025-05-05 14:48:05,518 [INFO] email_processor: No failed batches to retry
2025-05-05 14:48:05,518 [INFO] email_processor: Starting new batch processor run
2025-05-05 14:48:05,522 [INFO] email_processor: Created new batch run in PostgreSQL with ID: 3f5c0d68-2b1c-492a-8dfa-531b1faabd39
2025-05-05 14:48:05,522 [INFO] email_processor: Created new batch with ID: 3f5c0d68-2b1c-492a-8dfa-531b1faabd39
2025-05-05 14:48:05,532 [INFO] email_processor: MongoDB indexes setup complete
2025-05-05 14:48:05,532 [INFO] email_processor: Connected to MongoDB: db=email_classification, collection=emails
2025-05-05 14:48:05,533 [INFO] email_processor: Created missing batch record in MongoDB: 3f5c0d68-2b1c-492a-8dfa-531b1faabd39
2025-05-05 14:48:05,533 [INFO] email_processor: Processing batch 3f5c0d68-2b1c-492a-8dfa-531b1faabd39 (max 125)
2025-05-05 14:48:05,536 [INFO] email_processor: Using batch size from environment: 125
2025-05-05 14:48:05,820 [INFO] email_processor: Attempting token acquisition by refresh token.
2025-05-05 14:48:06,764 [INFO] email_processor: Successfully acquired access token via refresh token.
2025-05-05 14:48:06,765 [INFO] email_processor: Updated refresh token.
2025-05-05 14:48:07,184 [INFO] email_processor: Found parent folder 'Email Classification' (ID: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgAuAAADc-7mk_qVAUmJ2Z-yyV7fYgEAcZ70xL_pF0GgVLEMlLppiQAAABZEH9QAAAA=)
2025-05-05 14:48:07,458 [INFO] email_processor: Folder mapping ready (7 folders)
2025-05-05 14:48:07,736 [INFO] email_processor: Total unread emails in inbox: 0
2025-05-05 14:48:07,995 [INFO] email_processor: No unread emails to process.
2025-05-05 14:48:07,996 [INFO] email_processor: No emails to process.
2025-05-05 14:48:08,010 [INFO] email_processor: No draft emails found for batch 3f5c0d68-2b1c-492a-8dfa-531b1faabd39
2025-05-05 14:48:08,026 [INFO] email_processor: Updated batch 3f5c0d68-2b1c-492a-8dfa-531b1faabd39 with status: success
2025-05-05 14:48:08,027 [INFO] email_processor: No emails for batch 3f5c0d68-2b1c-492a-8dfa-531b1faabd39 to export
2025-05-05 14:48:08,027 [INFO] email_processor: Batch 3f5c0d68-2b1c-492a-8dfa-531b1faabd39 completed in 2.5s: 0 processed, 0 failed, 0 drafts
2025-05-05 14:48:08,027 [INFO] email_processor: Batch complete. Next batch in 597.5 seconds
2025-05-05 14:48:23,820 [INFO] email_processor: System shutdown requested (KeyboardInterrupt)
2025-05-05 14:48:23,821 [INFO] email_processor: === Email Processing System Shutdown ===
2025-05-05 17:51:15,051 [INFO] email_processor: Logging initialized at INFO level
2025-05-05 17:51:15,051 [INFO] email_processor: === Email Processing System Starting ===
2025-05-05 17:51:15,051 [INFO] email_processor: Settings:
2025-05-05 17:51:15,052 [INFO] email_processor: - MAIL_SEND_ENABLED: False
2025-05-05 17:51:15,052 [INFO] email_processor: - SFTP_ENABLED: True
2025-05-05 17:51:15,052 [INFO] email_processor: - BATCH_SIZE: 125
2025-05-05 17:51:15,052 [INFO] email_processor: - BATCH_INTERVAL: 600 seconds
2025-05-05 17:51:15,052 [INFO] email_processor: Cleaning up existing failed batches
2025-05-05 17:51:15,071 [INFO] email_processor: No failed batches to clean up
2025-05-05 17:51:15,071 [INFO] email_processor: Starting retry of failed batches
2025-05-05 17:51:15,079 [INFO] email_processor: No failed batches to retry
2025-05-05 17:51:15,079 [INFO] email_processor: Starting main email processing loop
2025-05-05 17:51:15,079 [INFO] email_processor: Starting email batch processor (batch size: 125, interval: 600s)
2025-05-05 17:51:15,079 [INFO] email_processor: Mail sending is DISABLED
2025-05-05 17:51:15,079 [INFO] email_processor: SFTP export is ENABLED
2025-05-05 17:51:15,079 [INFO] email_processor: Cleaning up existing failed batches
2025-05-05 17:51:15,084 [INFO] email_processor: No failed batches to clean up
2025-05-05 17:51:15,084 [INFO] email_processor: Starting batch at 2025-05-05T17:51:15.084462
2025-05-05 17:51:15,084 [INFO] email_processor: Starting retry of failed batches
2025-05-05 17:51:15,089 [INFO] email_processor: No failed batches to retry
2025-05-05 17:51:15,089 [INFO] email_processor: Starting new batch processor run
2025-05-05 17:51:15,094 [INFO] email_processor: Created new batch run in PostgreSQL with ID: 62bd3d31-469b-4e59-8784-91fc7ec232a4
2025-05-05 17:51:15,094 [INFO] email_processor: Created new batch with ID: 62bd3d31-469b-4e59-8784-91fc7ec232a4
2025-05-05 17:51:15,105 [INFO] email_processor: MongoDB indexes setup complete
2025-05-05 17:51:15,105 [INFO] email_processor: Connected to MongoDB: db=email_classification, collection=emails
2025-05-05 17:51:15,106 [INFO] email_processor: Created missing batch record in MongoDB: 62bd3d31-469b-4e59-8784-91fc7ec232a4
2025-05-05 17:51:15,106 [INFO] email_processor: Processing batch 62bd3d31-469b-4e59-8784-91fc7ec232a4 (max 125)
2025-05-05 17:51:15,111 [INFO] email_processor: Using batch size from environment: 125
2025-05-05 17:51:15,450 [INFO] email_processor: Attempting token acquisition by refresh token.
2025-05-05 17:51:16,316 [INFO] email_processor: Successfully acquired access token via refresh token.
2025-05-05 17:51:16,316 [INFO] email_processor: Updated refresh token.
2025-05-05 17:51:16,732 [INFO] httpx: HTTP Request: GET https://graph.microsoft.com/v1.0/me/mailFolders?$top=1000 "HTTP/1.1 200 OK"
2025-05-05 17:51:16,733 [INFO] email_processor: Found parent folder 'Email Classification' (ID: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgAuAAADc-7mk_qVAUmJ2Z-yyV7fYgEAcZ70xL_pF0GgVLEMlLppiQAAABZEH9QAAAA=)
2025-05-05 17:51:16,974 [INFO] httpx: HTTP Request: GET https://graph.microsoft.com/v1.0/me/mailFolders/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgAuAAADc-7mk_qVAUmJ2Z-yyV7fYgEAcZ70xL_pF0GgVLEMlLppiQAAABZEH9QAAAA=/childFolders?$top=100 "HTTP/1.1 200 OK"
2025-05-05 17:51:16,976 [INFO] email_processor: Folder mapping ready (7 folders)
2025-05-05 17:51:17,229 [INFO] httpx: HTTP Request: GET https://graph.microsoft.com/v1.0/me/mailFolders/inbox/messages/$count?%24filter=isRead+eq+false "HTTP/1.1 200 OK"
2025-05-05 17:51:17,231 [INFO] email_processor: Total unread emails in inbox: 4
2025-05-05 17:51:17,499 [INFO] httpx: HTTP Request: GET https://graph.microsoft.com/v1.0/me/mailFolders/inbox/messages?%24orderby=receivedDateTime+desc&%24filter=isRead+eq+false+and+isDraft+eq+false+and+receivedDateTime+ge+2025-05-04T12%3A21%3A16Z&%24select=id%2Csubject%2Cfrom%2CbodyPreview%2CreceivedDateTime%2ChasAttachments&%24top=125 "HTTP/1.1 200 OK"
2025-05-05 17:51:17,501 [INFO] email_processor: Found 4 unread emails to process
2025-05-05 17:51:17,501 [INFO] email_processor: Processing email: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_Z4AAAA= | From: sanskargawande@gmail.com | Subject: Fwd: Out of Office Auto-Reply: Invoice Query
2025-05-05 17:51:17,545 [INFO] email_processor: Classification API returned: {'subject': 'Fwd: Out of Office Auto-Reply: Invoice Query', 'label': 'auto_reply_with_info', 'confidence': 0.98, 'method': 'rule_based', 'matching_patterns': ['out of office'], 'entities': {'emails': ['sarah.johnson@abccompany.com'], 'phones': ['555) 123-4567'], 'invoice_numbers': [], 'reference_numbers': [], 'due_dates': [], 'payment_dates': [], 'return_dates': ['May 15, 2025'], 'subject': 'Fwd: Out of Office Auto-Reply: Invoice Query', 'body': 'Thank you for your email. I am currently out of the office until May 15, 2025.\r\n\r\nFor urgent matters regarding invoices or payments, please contact:\r\nSarah Johnson\r\nEmail: sarah.johnson@abccompany.com\r\nPhone: (555) 123-4567\r\n\r\nI will respond to your ema', 'people': ['Email', 'Sarah Johnson'], 'organizations': [], 'dates': ['May 15, 2025'], 'amounts': [], 'has_team_reorganization': False, 'has_complex_query': False, 'has_contact_info': True, 'has_no_reply_needed': False, 'ooo_person': {'name': 'Email', 'email': None}, 'ooo_contact_person': {'name': 'Sarah Johnson', 'email': 'sarah.johnson@abccompany.com', 'phone': '555) 123-4567'}, 'ooo_dates': {'start': None, 'end': 'May 15, 2025'}}}
2025-05-05 17:51:17,545 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_Z4AAAA= classified as 'auto_reply_with_info' with confidence 0.98
2025-05-05 17:51:17,546 [INFO] email_processor: Email inserted with ID: 6818ad3dcdf42fd7302e7950
2025-05-05 17:51:17,546 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_Z4AAAA= flagged for manual review and will be saved as draft
2025-05-05 17:51:17,904 [INFO] httpx: HTTP Request: PATCH https://graph.microsoft.com/v1.0/me/messages/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_Z4AAAA= "HTTP/1.1 200 OK"
2025-05-05 17:51:18,292 [INFO] httpx: HTTP Request: POST https://graph.microsoft.com/v1.0/me/messages/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_Z4AAAA=/move "HTTP/1.1 201 Created"
2025-05-05 17:51:18,301 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_Z4AAAA= moved to folder ID: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgAuAAADc-7mk_qVAUmJ2Z-yyV7fYgEAcZ70xL_pF0GgVLEMlLppiQAAABZEH9gAAAA=
2025-05-05 17:51:18,301 [INFO] email_processor: Processing email: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_Z0AAAA= | From: sanskargawande@gmail.com | Subject: Fwd: New Account Manager at Acme Financial Services
2025-05-05 17:51:18,331 [INFO] email_processor: Classification API returned: {'subject': 'Fwd: New Account Manager at Acme Financial Services', 'label': 'no_reply_no_info', 'confidence': 0.98, 'method': 'rule_based', 'matching_patterns': ['no longer with', 'is no longer with'], 'entities': {'emails': [], 'phones': [], 'invoice_numbers': [], 'reference_numbers': [], 'due_dates': [], 'payment_dates': [], 'return_dates': [], 'subject': 'Fwd: New Account Manager at Acme Financial Services', 'body': 'Dear Valued Customer,\r\n\r\n I wanted to inform you that Sarah Johnson is no longer with Acme Financial Services as of May 1, 2025.\r\n Moving forward, your new account manager will be Michael Rodriguez. He has extensive experience in financial services and ', 'people': ['Sarah Johnson', 'Michael Rodriguez'], 'organizations': ['Acme Financial Services', 'Acme Financial Services Dear Valued Customer'], 'dates': ['May 1, 2025'], 'amounts': [], 'has_team_reorganization': False, 'has_complex_query': False, 'has_contact_info': False, 'has_no_reply_needed': False, 'left_person': {'name': 'Sarah Johnson', 'email': None}, 'replacement_contact': {'name': 'Michael Rodriguez', 'email': None, 'phone': None}, 'replacement_contact_info': {'emails': [], 'phones': []}}}
2025-05-05 17:51:18,331 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_Z0AAAA= classified as 'no_reply_no_info' with confidence 0.98
2025-05-05 17:51:18,332 [INFO] email_processor: Email inserted with ID: 6818ad3ecdf42fd7302e7951
2025-05-05 17:51:18,332 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_Z0AAAA= flagged for manual review and will be saved as draft
2025-05-05 17:51:18,663 [INFO] httpx: HTTP Request: PATCH https://graph.microsoft.com/v1.0/me/messages/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_Z0AAAA= "HTTP/1.1 200 OK"
2025-05-05 17:51:19,193 [INFO] httpx: HTTP Request: POST https://graph.microsoft.com/v1.0/me/messages/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_Z0AAAA=/move "HTTP/1.1 201 Created"
2025-05-05 17:51:19,195 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_Z0AAAA= moved to folder ID: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgAuAAADc-7mk_qVAUmJ2Z-yyV7fYgEAcZ70xL_pF0GgVLEMlLppiQAAABZEH9UAAAA=
2025-05-05 17:51:19,196 [INFO] email_processor: Processing email: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_ZwAAAA= | From: sanskargawande@gmail.com | Subject: Fwd: Change of phone number and contact information
2025-05-05 17:51:23,110 [INFO] email_processor: Classification API returned: {'subject': 'Fwd: Change of phone number and contact information', 'label': 'manual_review', 'confidence': 0.40070071816444397, 'method': 'roberta_model', 'matching_patterns': [], 'entities': {'emails': [], 'phones': ['628) 555-7821', '415) 555-2390'], 'invoice_numbers': [], 'reference_numbers': [], 'due_dates': [], 'payment_dates': [], 'return_dates': [], 'subject': 'Fwd: Change of phone number and contact information', 'body': 'Hello,\r\n\r\nPlease note that effective immediately, our California support team has a new phone number.\r\n\r\nOld number: (415) 555-2390\r\nNew number: (628) 555-7821\r\n\r\nOur support hours remain the same: Monday to Friday, 7:00 AM to 6:00 PM Pacific Time.\r\n\r\nFor', 'people': [], 'organizations': [], 'dates': ['Monday to Friday'], 'amounts': [], 'has_team_reorganization': False, 'has_complex_query': False, 'has_contact_info': True, 'has_no_reply_needed': False}}
2025-05-05 17:51:23,111 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_ZwAAAA= classified as 'manual_review' with confidence 0.40
2025-05-05 17:51:23,112 [INFO] email_processor: Email inserted with ID: 6818ad43cdf42fd7302e7952
2025-05-05 17:51:23,112 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_ZwAAAA= flagged for manual review and will be saved as draft
2025-05-05 17:51:23,449 [INFO] httpx: HTTP Request: PATCH https://graph.microsoft.com/v1.0/me/messages/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_ZwAAAA= "HTTP/1.1 200 OK"
2025-05-05 17:51:23,773 [INFO] httpx: HTTP Request: POST https://graph.microsoft.com/v1.0/me/messages/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_ZwAAAA=/move "HTTP/1.1 201 Created"
2025-05-05 17:51:23,775 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_ZwAAAA= moved to folder ID: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgAuAAADc-7mk_qVAUmJ2Z-yyV7fYgEAcZ70xL_pF0GgVLEMlLppiQAAABZEH9sAAAA=
2025-05-05 17:51:23,775 [INFO] email_processor: Processing email: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_ZsAAAA= | From: sanskargawande@gmail.com | Subject: Multiple Questions about Invoice Processing and Account Status
2025-05-05 17:51:23,815 [INFO] email_processor: Classification API returned: {'subject': 'Multiple Questions about Invoice Processing and Account Status', 'label': 'manual_review', 'confidence': 0.95, 'method': 'rule_based', 'matching_patterns': ['several questions', 'multiple questions'], 'entities': {'emails': [], 'phones': ['2025-03459'], 'invoice_numbers': [], 'reference_numbers': [], 'due_dates': [], 'payment_dates': [], 'return_dates': [], 'subject': 'Multiple Questions about Invoice Processing and Account Status', 'body': 'Hello Support Team,\r\n\r\nI have several questions regarding our account and recent invoices:\r\n\r\n1. For invoice #BIL-2025-03459, we were charged $1,250 for additional user licenses, but our contract states we should pay $950 for the same service tier. Can ', 'people': [], 'organizations': ['Invoice Processing and Account Status Hello Support Team'], 'dates': [], 'amounts': ['1,250', '950'], 'has_team_reorganization': False, 'has_complex_query': True, 'has_contact_info': True, 'has_no_reply_needed': False}}
2025-05-05 17:51:23,816 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_ZsAAAA= classified as 'manual_review' with confidence 0.95
2025-05-05 17:51:23,816 [INFO] email_processor: Email inserted with ID: 6818ad43cdf42fd7302e7953
2025-05-05 17:51:23,816 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_ZsAAAA= flagged for manual review and will be saved as draft
2025-05-05 17:51:24,126 [INFO] httpx: HTTP Request: PATCH https://graph.microsoft.com/v1.0/me/messages/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_ZsAAAA= "HTTP/1.1 200 OK"
2025-05-05 17:51:24,435 [INFO] httpx: HTTP Request: POST https://graph.microsoft.com/v1.0/me/messages/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_ZsAAAA=/move "HTTP/1.1 201 Created"
2025-05-05 17:51:24,437 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_ZsAAAA= moved to folder ID: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgAuAAADc-7mk_qVAUmJ2Z-yyV7fYgEAcZ70xL_pF0GgVLEMlLppiQAAABZEH9sAAAA=
2025-05-05 17:51:24,461 [INFO] email_processor: MongoDB indexes setup complete
2025-05-05 17:51:24,461 [INFO] email_processor: Connected to MongoDB: db=email_classification, collection=emails
2025-05-05 17:51:24,462 [INFO] email_processor: No emails to save as drafts.
2025-05-05 17:51:24,462 [INFO] email_processor: Draft processing complete: 0 saved as drafts
2025-05-05 17:51:24,462 [INFO] email_processor: Synchronized 0 emails to PostgreSQL for batch 62bd3d31-469b-4e59-8784-91fc7ec232a4
2025-05-05 17:51:24,470 [INFO] email_processor: Email processing summary:
2025-05-05 17:51:24,470 [INFO] email_processor: - Emails processed: 4
2025-05-05 17:51:24,470 [INFO] email_processor: - Emails skipped: 0
2025-05-05 17:51:24,471 [INFO] email_processor: - Emails errored: 0
2025-05-05 17:51:24,471 [INFO] email_processor: - Emails saved as drafts: 0
2025-05-05 17:51:24,478 [INFO] email_processor: No draft emails found for batch 62bd3d31-469b-4e59-8784-91fc7ec232a4
2025-05-05 17:51:24,490 [INFO] email_processor: Updated batch 62bd3d31-469b-4e59-8784-91fc7ec232a4 with status: success
2025-05-05 17:51:24,491 [INFO] email_processor: Updated email flags: 0 emails set for response, 4 set as non-response
2025-05-05 17:51:24,498 [INFO] email_processor: Successfully inserted batch_id=62bd3d31-469b-4e59-8784-91fc7ec232a4 into account_email
2025-05-05 17:51:24,498 [INFO] email_processor: Inserted batch tracking record with batch_id=62bd3d31-469b-4e59-8784-91fc7ec232a4
2025-05-05 17:51:24,498 [INFO] email_processor: Mail sending is disabled. Skipping batch 62bd3d31-469b-4e59-8784-91fc7ec232a4
2025-05-05 17:51:24,568 [INFO] email_processor: Generated unique filename: AI_Agent_Data_Load_20250505_175124_7ec232a4_20250505_175124_bf6c2423.xlsx to prevent overwrites
2025-05-05 17:51:24,568 [INFO] email_processor: Connecting to SFTP server sftp.abc-amega.com:22 with username Sanskar
2025-05-05 17:51:26,520 [INFO] email_processor: Opening SFTP session for AI_Agent_Data_Load_20250505_175124_7ec232a4.xlsx
2025-05-05 17:51:27,247 [INFO] email_processor: Uploading file AI_Agent_Data_Load_20250505_175124_7ec232a4.xlsx to AI_Agent_Data_Load_20250505_175124_7ec232a4_20250505_175124_bf6c2423.xlsx via SFTP
2025-05-05 17:51:28,432 [INFO] email_processor: Successfully uploaded AI_Agent_Data_Load_20250505_175124_7ec232a4.xlsx to SFTP server as AI_Agent_Data_Load_20250505_175124_7ec232a4_20250505_175124_bf6c2423.xlsx
2025-05-05 17:51:28,434 [INFO] email_processor: Excel file exported and uploaded: AI_Agent_Data_Load_20250505_175124_7ec232a4.xlsx
2025-05-05 17:51:28,435 [INFO] email_processor: Batch 62bd3d31-469b-4e59-8784-91fc7ec232a4 completed in 13.3s: 4 processed, 0 failed, 4 drafts
2025-05-05 17:51:28,435 [INFO] email_processor: Batch complete. Next batch in 586.6 seconds
2025-05-05 17:58:15,748 [INFO] email_processor: System shutdown requested (KeyboardInterrupt)
2025-05-05 17:58:15,750 [INFO] email_processor: === Email Processing System Shutdown ===
2025-05-05 17:59:38,685 [INFO] email_processor: Logging initialized at INFO level
2025-05-05 17:59:38,685 [INFO] email_processor: === Email Processing System Starting ===
2025-05-05 17:59:38,685 [INFO] email_processor: Settings:
2025-05-05 17:59:38,685 [INFO] email_processor: - MAIL_SEND_ENABLED: False
2025-05-05 17:59:38,685 [INFO] email_processor: - SFTP_ENABLED: True
2025-05-05 17:59:38,686 [INFO] email_processor: - BATCH_SIZE: 125
2025-05-05 17:59:38,686 [INFO] email_processor: - BATCH_INTERVAL: 600 seconds
2025-05-05 17:59:38,686 [INFO] email_processor: Cleaning up existing failed batches
2025-05-05 17:59:38,700 [INFO] email_processor: No failed batches to clean up
2025-05-05 17:59:38,700 [INFO] email_processor: Starting retry of failed batches
2025-05-05 17:59:38,708 [INFO] email_processor: No failed batches to retry
2025-05-05 17:59:38,708 [INFO] email_processor: Starting main email processing loop
2025-05-05 17:59:38,708 [INFO] email_processor: Starting email batch processor (batch size: 125, interval: 600s)
2025-05-05 17:59:38,708 [INFO] email_processor: Mail sending is DISABLED
2025-05-05 17:59:38,708 [INFO] email_processor: SFTP export is ENABLED
2025-05-05 17:59:38,708 [INFO] email_processor: Cleaning up existing failed batches
2025-05-05 17:59:38,713 [INFO] email_processor: No failed batches to clean up
2025-05-05 17:59:38,713 [INFO] email_processor: Starting batch at 2025-05-05T17:59:38.713674
2025-05-05 17:59:38,713 [INFO] email_processor: Starting retry of failed batches
2025-05-05 17:59:38,718 [INFO] email_processor: No failed batches to retry
2025-05-05 17:59:38,718 [INFO] email_processor: Starting new batch processor run
2025-05-05 17:59:38,723 [INFO] email_processor: Created new batch run in PostgreSQL with ID: e80471eb-61e1-43b6-89f2-1768941a3286
2025-05-05 17:59:38,723 [INFO] email_processor: Created new batch with ID: e80471eb-61e1-43b6-89f2-1768941a3286
2025-05-05 17:59:38,732 [INFO] email_processor: MongoDB indexes setup complete
2025-05-05 17:59:38,732 [INFO] email_processor: Connected to MongoDB: db=email_classification, collection=emails
2025-05-05 17:59:38,733 [INFO] email_processor: Created missing batch record in MongoDB: e80471eb-61e1-43b6-89f2-1768941a3286
2025-05-05 17:59:38,733 [INFO] email_processor: Processing batch e80471eb-61e1-43b6-89f2-1768941a3286 (max 125)
2025-05-05 17:59:38,736 [INFO] email_processor: Using batch size from environment: 125
2025-05-05 17:59:38,969 [INFO] email_processor: Attempting token acquisition by refresh token.
2025-05-05 17:59:39,667 [INFO] email_processor: Successfully acquired access token via refresh token.
2025-05-05 17:59:39,668 [INFO] email_processor: Updated refresh token.
2025-05-05 17:59:40,074 [INFO] httpx: HTTP Request: GET https://graph.microsoft.com/v1.0/me/mailFolders?$top=1000 "HTTP/1.1 200 OK"
2025-05-05 17:59:40,076 [INFO] email_processor: Found parent folder 'Email Classification' (ID: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgAuAAADc-7mk_qVAUmJ2Z-yyV7fYgEAcZ70xL_pF0GgVLEMlLppiQAAABZEH9QAAAA=)
2025-05-05 17:59:40,320 [INFO] httpx: HTTP Request: GET https://graph.microsoft.com/v1.0/me/mailFolders/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgAuAAADc-7mk_qVAUmJ2Z-yyV7fYgEAcZ70xL_pF0GgVLEMlLppiQAAABZEH9QAAAA=/childFolders?$top=100 "HTTP/1.1 200 OK"
2025-05-05 17:59:40,320 [INFO] email_processor: Folder mapping ready (7 folders)
2025-05-05 17:59:40,602 [INFO] httpx: HTTP Request: GET https://graph.microsoft.com/v1.0/me/mailFolders/inbox/messages/$count?%24filter=isRead+eq+false "HTTP/1.1 200 OK"
2025-05-05 17:59:40,602 [INFO] email_processor: Total unread emails in inbox: 0
2025-05-05 17:59:40,859 [INFO] httpx: HTTP Request: GET https://graph.microsoft.com/v1.0/me/mailFolders/inbox/messages?%24orderby=receivedDateTime+desc&%24filter=isRead+eq+false+and+isDraft+eq+false+and+receivedDateTime+ge+2025-05-04T12%3A29%3A40Z&%24select=id%2Csubject%2Cfrom%2CbodyPreview%2CreceivedDateTime%2ChasAttachments&%24top=125 "HTTP/1.1 200 OK"
2025-05-05 17:59:40,861 [INFO] email_processor: No unread emails to process.
2025-05-05 17:59:40,861 [INFO] email_processor: No emails to process.
2025-05-05 17:59:40,874 [INFO] email_processor: No draft emails found for batch e80471eb-61e1-43b6-89f2-1768941a3286
2025-05-05 17:59:40,894 [INFO] email_processor: Updated batch e80471eb-61e1-43b6-89f2-1768941a3286 with status: success
2025-05-05 17:59:40,895 [INFO] email_processor: No emails for batch e80471eb-61e1-43b6-89f2-1768941a3286 to export
2025-05-05 17:59:40,895 [INFO] email_processor: Batch e80471eb-61e1-43b6-89f2-1768941a3286 completed in 2.2s: 0 processed, 0 failed, 0 drafts
2025-05-05 17:59:40,895 [INFO] email_processor: Batch complete. Next batch in 597.8 seconds
2025-05-05 17:59:45,442 [INFO] email_processor: System shutdown requested (KeyboardInterrupt)
2025-05-05 17:59:45,443 [INFO] email_processor: === Email Processing System Shutdown ===
2025-05-05 17:59:47,605 [INFO] email_processor: Logging initialized at INFO level
2025-05-05 17:59:47,605 [INFO] email_processor: === Email Processing System Starting ===
2025-05-05 17:59:47,605 [INFO] email_processor: Settings:
2025-05-05 17:59:47,605 [INFO] email_processor: - MAIL_SEND_ENABLED: False
2025-05-05 17:59:47,605 [INFO] email_processor: - SFTP_ENABLED: True
2025-05-05 17:59:47,605 [INFO] email_processor: - BATCH_SIZE: 125
2025-05-05 17:59:47,605 [INFO] email_processor: - BATCH_INTERVAL: 600 seconds
2025-05-05 17:59:47,605 [INFO] email_processor: Cleaning up existing failed batches
2025-05-05 17:59:47,620 [INFO] email_processor: No failed batches to clean up
2025-05-05 17:59:47,620 [INFO] email_processor: Starting retry of failed batches
2025-05-05 17:59:47,628 [INFO] email_processor: No failed batches to retry
2025-05-05 17:59:47,628 [INFO] email_processor: Starting main email processing loop
2025-05-05 17:59:47,628 [INFO] email_processor: Starting email batch processor (batch size: 125, interval: 600s)
2025-05-05 17:59:47,628 [INFO] email_processor: Mail sending is DISABLED
2025-05-05 17:59:47,628 [INFO] email_processor: SFTP export is ENABLED
2025-05-05 17:59:47,628 [INFO] email_processor: Cleaning up existing failed batches
2025-05-05 17:59:47,633 [INFO] email_processor: No failed batches to clean up
2025-05-05 17:59:47,633 [INFO] email_processor: Starting batch at 2025-05-05T17:59:47.633451
2025-05-05 17:59:47,633 [INFO] email_processor: Starting retry of failed batches
2025-05-05 17:59:47,638 [INFO] email_processor: No failed batches to retry
2025-05-05 17:59:47,638 [INFO] email_processor: Starting new batch processor run
2025-05-05 17:59:47,643 [INFO] email_processor: Created new batch run in PostgreSQL with ID: 3edcc395-7701-4d66-8f7a-b86a0a18aaa3
2025-05-05 17:59:47,643 [INFO] email_processor: Created new batch with ID: 3edcc395-7701-4d66-8f7a-b86a0a18aaa3
2025-05-05 17:59:47,653 [INFO] email_processor: MongoDB indexes setup complete
2025-05-05 17:59:47,654 [INFO] email_processor: Connected to MongoDB: db=email_classification, collection=emails
2025-05-05 17:59:47,654 [INFO] email_processor: Created missing batch record in MongoDB: 3edcc395-7701-4d66-8f7a-b86a0a18aaa3
2025-05-05 17:59:47,654 [INFO] email_processor: Processing batch 3edcc395-7701-4d66-8f7a-b86a0a18aaa3 (max 125)
2025-05-05 17:59:47,660 [INFO] email_processor: Using batch size from environment: 125
2025-05-05 17:59:47,928 [INFO] email_processor: Attempting token acquisition by refresh token.
2025-05-05 17:59:48,825 [INFO] email_processor: Successfully acquired access token via refresh token.
2025-05-05 17:59:48,825 [INFO] email_processor: Updated refresh token.
2025-05-05 17:59:49,109 [INFO] httpx: HTTP Request: GET https://graph.microsoft.com/v1.0/me/mailFolders?$top=1000 "HTTP/1.1 200 OK"
2025-05-05 17:59:49,111 [INFO] email_processor: Found parent folder 'Email Classification' (ID: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgAuAAADc-7mk_qVAUmJ2Z-yyV7fYgEAcZ70xL_pF0GgVLEMlLppiQAAABZEH9QAAAA=)
2025-05-05 17:59:49,521 [INFO] httpx: HTTP Request: GET https://graph.microsoft.com/v1.0/me/mailFolders/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgAuAAADc-7mk_qVAUmJ2Z-yyV7fYgEAcZ70xL_pF0GgVLEMlLppiQAAABZEH9QAAAA=/childFolders?$top=100 "HTTP/1.1 200 OK"
2025-05-05 17:59:49,523 [INFO] email_processor: Folder mapping ready (7 folders)
2025-05-05 17:59:49,801 [INFO] httpx: HTTP Request: GET https://graph.microsoft.com/v1.0/me/mailFolders/inbox/messages/$count?%24filter=isRead+eq+false "HTTP/1.1 200 OK"
2025-05-05 17:59:49,802 [INFO] email_processor: Total unread emails in inbox: 1
2025-05-05 17:59:50,041 [INFO] httpx: HTTP Request: GET https://graph.microsoft.com/v1.0/me/mailFolders/inbox/messages?%24orderby=receivedDateTime+desc&%24filter=isRead+eq+false+and+isDraft+eq+false+and+receivedDateTime+ge+2025-05-04T12%3A29%3A49Z&%24select=id%2Csubject%2Cfrom%2CbodyPreview%2CreceivedDateTime%2ChasAttachments&%24top=125 "HTTP/1.1 200 OK"
2025-05-05 17:59:50,043 [INFO] email_processor: Found 1 unread emails to process
2025-05-05 17:59:50,043 [INFO] email_processor: Processing email: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_Z8AAAA= | From: sanskargawande@gmail.com | Subject: Fwd: Out of Office Auto-Reply: Invoice Query
2025-05-05 17:59:50,085 [INFO] email_processor: Classification API returned: {'subject': 'Fwd: Out of Office Auto-Reply: Invoice Query', 'label': 'auto_reply_with_info', 'confidence': 0.98, 'method': 'rule_based', 'matching_patterns': ['out of office'], 'entities': {'emails': ['sarah.johnson@abccompany.com'], 'phones': ['555) 123-4567'], 'invoice_numbers': [], 'reference_numbers': [], 'due_dates': [], 'payment_dates': [], 'return_dates': ['May 15, 2025'], 'subject': 'Fwd: Out of Office Auto-Reply: Invoice Query', 'body': 'Thank you for your email. I am currently out of the office until May 15, 2025.\r\n\r\nFor urgent matters regarding invoices or payments, please contact:\r\nSarah Johnson\r\nEmail: sarah.johnson@abccompany.com\r\nPhone: (555) 123-4567\r\n\r\nI will respond to your e', 'people': ['Email', 'Sarah Johnson'], 'organizations': [], 'dates': ['May 15, 2025'], 'amounts': [], 'has_team_reorganization': False, 'has_complex_query': False, 'has_contact_info': True, 'has_no_reply_needed': False, 'ooo_person': {'name': 'Email', 'email': None}, 'ooo_contact_person': {'name': 'Sarah Johnson', 'email': 'sarah.johnson@abccompany.com', 'phone': '555) 123-4567'}, 'ooo_dates': {'start': None, 'end': 'May 15, 2025'}}}
2025-05-05 17:59:50,086 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_Z8AAAA= classified as 'auto_reply_with_info' with confidence 0.98
2025-05-05 17:59:50,087 [INFO] email_processor: Email inserted with ID: 6818af3e1f8de152ac47a5af
2025-05-05 17:59:50,087 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_Z8AAAA= flagged for manual review and will be saved as draft
2025-05-05 17:59:50,432 [INFO] httpx: HTTP Request: PATCH https://graph.microsoft.com/v1.0/me/messages/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_Z8AAAA= "HTTP/1.1 200 OK"
2025-05-05 17:59:50,727 [INFO] httpx: HTTP Request: POST https://graph.microsoft.com/v1.0/me/messages/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_Z8AAAA=/move "HTTP/1.1 201 Created"
2025-05-05 17:59:50,737 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_Z8AAAA= moved to folder ID: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgAuAAADc-7mk_qVAUmJ2Z-yyV7fYgEAcZ70xL_pF0GgVLEMlLppiQAAABZEH9gAAAA=
2025-05-05 17:59:50,749 [INFO] email_processor: MongoDB indexes setup complete
2025-05-05 17:59:50,750 [INFO] email_processor: Connected to MongoDB: db=email_classification, collection=emails
2025-05-05 17:59:50,750 [INFO] email_processor: No emails to save as drafts.
2025-05-05 17:59:50,751 [INFO] email_processor: Draft processing complete: 0 saved as drafts
2025-05-05 17:59:50,751 [INFO] email_processor: Synchronized 0 emails to PostgreSQL for batch 3edcc395-7701-4d66-8f7a-b86a0a18aaa3
2025-05-05 17:59:50,759 [INFO] email_processor: Email processing summary:
2025-05-05 17:59:50,759 [INFO] email_processor: - Emails processed: 1
2025-05-05 17:59:50,760 [INFO] email_processor: - Emails skipped: 0
2025-05-05 17:59:50,760 [INFO] email_processor: - Emails errored: 0
2025-05-05 17:59:50,760 [INFO] email_processor: - Emails saved as drafts: 0
2025-05-05 17:59:50,768 [INFO] email_processor: No draft emails found for batch 3edcc395-7701-4d66-8f7a-b86a0a18aaa3
2025-05-05 17:59:50,788 [INFO] email_processor: Updated batch 3edcc395-7701-4d66-8f7a-b86a0a18aaa3 with status: success
2025-05-05 17:59:50,790 [INFO] email_processor: Updated email flags: 0 emails set for response, 1 set as non-response
2025-05-05 17:59:50,798 [INFO] email_processor: Successfully inserted batch_id=3edcc395-7701-4d66-8f7a-b86a0a18aaa3 into account_email
2025-05-05 17:59:50,798 [INFO] email_processor: Inserted batch tracking record with batch_id=3edcc395-7701-4d66-8f7a-b86a0a18aaa3
2025-05-05 17:59:50,798 [INFO] email_processor: Mail sending is disabled. Skipping batch 3edcc395-7701-4d66-8f7a-b86a0a18aaa3
2025-05-05 17:59:50,867 [INFO] email_processor: Generated unique filename: AI_Agent_Data_Load_20250505_175950_0a18aaa3_20250505_175950_5af90463.xlsx to prevent overwrites
2025-05-05 17:59:50,867 [INFO] email_processor: Connecting to SFTP server sftp.abc-amega.com:22 with username Sanskar
2025-05-05 17:59:52,761 [INFO] email_processor: Opening SFTP session for AI_Agent_Data_Load_20250505_175950_0a18aaa3.xlsx
2025-05-05 17:59:53,582 [INFO] email_processor: Uploading file AI_Agent_Data_Load_20250505_175950_0a18aaa3.xlsx to AI_Agent_Data_Load_20250505_175950_0a18aaa3_20250505_175950_5af90463.xlsx via SFTP
2025-05-05 17:59:54,875 [INFO] email_processor: Successfully uploaded AI_Agent_Data_Load_20250505_175950_0a18aaa3.xlsx to SFTP server as AI_Agent_Data_Load_20250505_175950_0a18aaa3_20250505_175950_5af90463.xlsx
2025-05-05 17:59:54,876 [INFO] email_processor: Excel file exported and uploaded: AI_Agent_Data_Load_20250505_175950_0a18aaa3.xlsx
2025-05-05 17:59:54,876 [INFO] email_processor: Batch 3edcc395-7701-4d66-8f7a-b86a0a18aaa3 completed in 7.2s: 1 processed, 0 failed, 1 drafts
2025-05-05 17:59:54,876 [INFO] email_processor: Batch complete. Next batch in 592.8 seconds
2025-05-05 18:00:33,541 [INFO] email_processor: System shutdown requested (KeyboardInterrupt)
2025-05-05 18:00:33,542 [INFO] email_processor: === Email Processing System Shutdown ===
2025-05-05 18:04:44,012 [INFO] email_processor: Logging initialized at INFO level
2025-05-05 18:04:44,012 [INFO] email_processor: === Email Processing System Starting ===
2025-05-05 18:04:44,012 [INFO] email_processor: Settings:
2025-05-05 18:04:44,012 [INFO] email_processor: - MAIL_SEND_ENABLED: False
2025-05-05 18:04:44,012 [INFO] email_processor: - SFTP_ENABLED: True
2025-05-05 18:04:44,012 [INFO] email_processor: - BATCH_SIZE: 125
2025-05-05 18:04:44,012 [INFO] email_processor: - BATCH_INTERVAL: 600 seconds
2025-05-05 18:04:44,012 [INFO] email_processor: Cleaning up existing failed batches
2025-05-05 18:04:44,028 [INFO] email_processor: No failed batches to clean up
2025-05-05 18:04:44,029 [INFO] email_processor: Starting retry of failed batches
2025-05-05 18:04:44,037 [INFO] email_processor: No failed batches to retry
2025-05-05 18:04:44,037 [INFO] email_processor: Starting main email processing loop
2025-05-05 18:04:44,037 [INFO] email_processor: Starting email batch processor (batch size: 125, interval: 600s)
2025-05-05 18:04:44,037 [INFO] email_processor: Mail sending is DISABLED
2025-05-05 18:04:44,037 [INFO] email_processor: SFTP export is ENABLED
2025-05-05 18:04:44,037 [INFO] email_processor: Cleaning up existing failed batches
2025-05-05 18:04:44,041 [INFO] email_processor: No failed batches to clean up
2025-05-05 18:04:44,041 [INFO] email_processor: Starting batch at 2025-05-05T18:04:44.041911
2025-05-05 18:04:44,041 [INFO] email_processor: Starting retry of failed batches
2025-05-05 18:04:44,046 [INFO] email_processor: No failed batches to retry
2025-05-05 18:04:44,046 [INFO] email_processor: Starting new batch processor run
2025-05-05 18:04:44,051 [INFO] email_processor: Created new batch run in PostgreSQL with ID: d0f68544-8c3e-4e57-a9d5-72e32bbd9f15
2025-05-05 18:04:44,052 [INFO] email_processor: Created new batch with ID: d0f68544-8c3e-4e57-a9d5-72e32bbd9f15
2025-05-05 18:04:44,062 [INFO] email_processor: MongoDB indexes setup complete
2025-05-05 18:04:44,062 [INFO] email_processor: Connected to MongoDB: db=email_classification, collection=emails
2025-05-05 18:04:44,063 [INFO] email_processor: Created missing batch record in MongoDB: d0f68544-8c3e-4e57-a9d5-72e32bbd9f15
2025-05-05 18:04:44,063 [INFO] email_processor: Processing batch d0f68544-8c3e-4e57-a9d5-72e32bbd9f15 (max 125)
2025-05-05 18:04:44,069 [INFO] email_processor: Using batch size from environment: 125
2025-05-05 18:04:44,475 [INFO] email_processor: Attempting token acquisition by refresh token.
2025-05-05 18:04:45,193 [INFO] email_processor: Successfully acquired access token via refresh token.
2025-05-05 18:04:45,193 [INFO] email_processor: Updated refresh token.
2025-05-05 18:04:45,548 [INFO] httpx: HTTP Request: GET https://graph.microsoft.com/v1.0/me/mailFolders?$top=1000 "HTTP/1.1 200 OK"
2025-05-05 18:04:45,551 [INFO] email_processor: Found parent folder 'Email Classification' (ID: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgAuAAADc-7mk_qVAUmJ2Z-yyV7fYgEAcZ70xL_pF0GgVLEMlLppiQAAABZEH9QAAAA=)
2025-05-05 18:04:45,818 [INFO] httpx: HTTP Request: GET https://graph.microsoft.com/v1.0/me/mailFolders/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgAuAAADc-7mk_qVAUmJ2Z-yyV7fYgEAcZ70xL_pF0GgVLEMlLppiQAAABZEH9QAAAA=/childFolders?$top=100 "HTTP/1.1 200 OK"
2025-05-05 18:04:45,820 [INFO] email_processor: Folder mapping ready (7 folders)
2025-05-05 18:04:46,098 [INFO] httpx: HTTP Request: GET https://graph.microsoft.com/v1.0/me/mailFolders/inbox/messages/$count?%24filter=isRead+eq+false "HTTP/1.1 200 OK"
2025-05-05 18:04:46,100 [INFO] email_processor: Total unread emails in inbox: 3
2025-05-05 18:04:46,390 [INFO] httpx: HTTP Request: GET https://graph.microsoft.com/v1.0/me/mailFolders/inbox/messages?%24orderby=receivedDateTime+desc&%24filter=isRead+eq+false+and+isDraft+eq+false+and+receivedDateTime+ge+2025-05-04T12%3A34%3A45Z&%24select=id%2Csubject%2Cfrom%2CbodyPreview%2CreceivedDateTime%2ChasAttachments&%24top=125 "HTTP/1.1 200 OK"
2025-05-05 18:04:46,392 [INFO] email_processor: Found 3 unread emails to process
2025-05-05 18:04:46,393 [INFO] email_processor: Processing email: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_aIAAAA= | From: sanskargawande@gmail.com | Subject: Fwd: New Account Manager at Acme Financial Services
2025-05-05 18:04:46,437 [INFO] email_processor: Classification API returned: {'subject': 'Fwd: New Account Manager at Acme Financial Services', 'label': 'no_reply_no_info', 'confidence': 0.98, 'method': 'rule_based', 'matching_patterns': ['no longer with', 'is no longer with'], 'entities': {'emails': [], 'phones': [], 'invoice_numbers': [], 'reference_numbers': [], 'due_dates': [], 'payment_dates': [], 'return_dates': [], 'subject': 'Fwd: New Account Manager at Acme Financial Services', 'body': 'Dear Valued Customer,\r\n\r\n I wanted to inform you that Sarah Johnson is no longer with Acme Financial Services as of May 1, 2025.\r\n Moving forward, your new account manager will be Michael Rodriguez. He has extensive experience in financial services and ', 'people': ['Sarah Johnson', 'Michael Rodriguez'], 'organizations': ['Acme Financial Services', 'Acme Financial Services Dear Valued Customer'], 'dates': ['May 1, 2025'], 'amounts': [], 'has_team_reorganization': False, 'has_complex_query': False, 'has_contact_info': False, 'has_no_reply_needed': False, 'left_person': {'name': 'Sarah Johnson', 'email': None}, 'replacement_contact': {'name': 'Michael Rodriguez', 'email': None, 'phone': None}, 'replacement_contact_info': {'emails': [], 'phones': []}}}
2025-05-05 18:04:46,437 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_aIAAAA= classified as 'no_reply_no_info' with confidence 0.98
2025-05-05 18:04:46,438 [INFO] email_processor: Email inserted with ID: 6818b066902a25d43e67e6cf
2025-05-05 18:04:46,438 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_aIAAAA= flagged for manual review and will be saved as draft
2025-05-05 18:04:46,765 [INFO] httpx: HTTP Request: PATCH https://graph.microsoft.com/v1.0/me/messages/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_aIAAAA= "HTTP/1.1 200 OK"
2025-05-05 18:04:47,084 [INFO] httpx: HTTP Request: POST https://graph.microsoft.com/v1.0/me/messages/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_aIAAAA=/move "HTTP/1.1 201 Created"
2025-05-05 18:04:47,092 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_aIAAAA= moved to folder ID: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgAuAAADc-7mk_qVAUmJ2Z-yyV7fYgEAcZ70xL_pF0GgVLEMlLppiQAAABZEH9UAAAA=
2025-05-05 18:04:47,092 [INFO] email_processor: Processing email: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_aEAAAA= | From: sanskargawande@gmail.com | Subject: Fwd: Contact Update
2025-05-05 18:04:47,125 [INFO] email_processor: Classification API returned: {'subject': 'Fwd: Contact Update', 'label': 'no_reply_with_info', 'confidence': 0.9, 'method': 'rule_based', 'matching_patterns': ['update', 'no response is required'], 'entities': {'emails': ['ap@globexindustries.com'], 'phones': ['+44\u202f20\u202f7946\u202f0711'], 'invoice_numbers': [], 'reference_numbers': [], 'due_dates': [], 'payment_dates': [], 'return_dates': [], 'subject': 'Fwd: Contact Update', 'body': 'Good afternoon,\r\n\r\nWe’ve re‑organized our AP team. All future invoices and payment questions should go to our shared mailbox\r\n    **ap@globexindustries.com**\r\nor directly to **Michael Hayes – +44\u202f20\u202f7946\u202f0711**.\r\n\r\nNo response is required unless you hav', 'people': ['Michael Hayes'], 'organizations': ['AP'], 'dates': [], 'amounts': [], 'has_team_reorganization': False, 'has_complex_query': False, 'has_contact_info': True, 'has_no_reply_needed': True}}
2025-05-05 18:04:47,125 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_aEAAAA= classified as 'no_reply_with_info' with confidence 0.90
2025-05-05 18:04:47,126 [INFO] email_processor: Email inserted with ID: 6818b067902a25d43e67e6d0
2025-05-05 18:04:47,126 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_aEAAAA= flagged for manual review and will be saved as draft
2025-05-05 18:04:47,416 [INFO] httpx: HTTP Request: PATCH https://graph.microsoft.com/v1.0/me/messages/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_aEAAAA= "HTTP/1.1 200 OK"
2025-05-05 18:04:47,735 [INFO] httpx: HTTP Request: POST https://graph.microsoft.com/v1.0/me/messages/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_aEAAAA=/move "HTTP/1.1 201 Created"
2025-05-05 18:04:47,736 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_aEAAAA= moved to folder ID: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgAuAAADc-7mk_qVAUmJ2Z-yyV7fYgEAcZ70xL_pF0GgVLEMlLppiQAAABZEH9YAAAA=
2025-05-05 18:04:47,737 [INFO] email_processor: Processing email: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_aAAAAA= | From: sanskargawande@gmail.com | Subject: Fwd: Multiple Questions about Invoice Processing and Account Status
2025-05-05 18:04:47,776 [INFO] email_processor: Classification API returned: {'subject': 'Fwd: Multiple Questions about Invoice Processing and Account Status', 'label': 'manual_review', 'confidence': 0.95, 'method': 'rule_based', 'matching_patterns': ['several questions', 'multiple questions'], 'entities': {'emails': [], 'phones': ['2025-03459'], 'invoice_numbers': [], 'reference_numbers': [], 'due_dates': [], 'payment_dates': [], 'return_dates': [], 'subject': 'Fwd: Multiple Questions about Invoice Processing and Account Status', 'body': 'Hello Support Team,\r\n\r\nI have several questions regarding our account and recent invoices:\r\n\r\n1. For invoice #BIL-2025-03459, we were charged $1,250 for additional user licenses, but our contract states we should pay $950 for the same service tier. Ca', 'people': [], 'organizations': ['Invoice Processing and Account Status Hello Support Team'], 'dates': [], 'amounts': ['1,250', '950'], 'has_team_reorganization': False, 'has_complex_query': True, 'has_contact_info': True, 'has_no_reply_needed': False}}
2025-05-05 18:04:47,776 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_aAAAAA= classified as 'manual_review' with confidence 0.95
2025-05-05 18:04:47,777 [INFO] email_processor: Email inserted with ID: 6818b067902a25d43e67e6d1
2025-05-05 18:04:47,777 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_aAAAAA= flagged for manual review and will be saved as draft
2025-05-05 18:04:48,054 [INFO] httpx: HTTP Request: PATCH https://graph.microsoft.com/v1.0/me/messages/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_aAAAAA= "HTTP/1.1 200 OK"
2025-05-05 18:04:48,396 [INFO] httpx: HTTP Request: POST https://graph.microsoft.com/v1.0/me/messages/AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_aAAAAA=/move "HTTP/1.1 201 Created"
2025-05-05 18:04:48,398 [INFO] email_processor: Email AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgBGAAADc-7mk_qVAUmJ2Z-yyV7fYgcAcZ70xL_pF0GgVLEMlLppiQAAAgEMAAAAcZ70xL_pF0GgVLEMlLppiQAAABi0_aAAAAA= moved to folder ID: AQMkADAwATM0MDAAMi04YWNiLTZlZjctMDACLTAwCgAuAAADc-7mk_qVAUmJ2Z-yyV7fYgEAcZ70xL_pF0GgVLEMlLppiQAAABZEH9sAAAA=
2025-05-05 18:04:48,407 [INFO] email_processor: MongoDB indexes setup complete
2025-05-05 18:04:48,407 [INFO] email_processor: Connected to MongoDB: db=email_classification, collection=emails
2025-05-05 18:04:48,408 [INFO] email_processor: No emails to save as drafts.
2025-05-05 18:04:48,408 [INFO] email_processor: Draft processing complete: 0 saved as drafts
2025-05-05 18:04:48,408 [INFO] email_processor: Synchronized 0 emails to PostgreSQL for batch d0f68544-8c3e-4e57-a9d5-72e32bbd9f15
2025-05-05 18:04:48,414 [INFO] email_processor: Email processing summary:
2025-05-05 18:04:48,414 [INFO] email_processor: - Emails processed: 3
2025-05-05 18:04:48,414 [INFO] email_processor: - Emails skipped: 0
2025-05-05 18:04:48,414 [INFO] email_processor: - Emails errored: 0
2025-05-05 18:04:48,414 [INFO] email_processor: - Emails saved as drafts: 0
2025-05-05 18:04:48,421 [INFO] email_processor: No draft emails found for batch d0f68544-8c3e-4e57-a9d5-72e32bbd9f15
2025-05-05 18:04:48,430 [INFO] email_processor: Updated batch d0f68544-8c3e-4e57-a9d5-72e32bbd9f15 with status: success
2025-05-05 18:04:48,431 [INFO] email_processor: Updated email flags: 0 emails set for response, 3 set as non-response
2025-05-05 18:04:48,438 [INFO] email_processor: Successfully inserted batch_id=d0f68544-8c3e-4e57-a9d5-72e32bbd9f15 into account_email
2025-05-05 18:04:48,438 [INFO] email_processor: Inserted batch tracking record with batch_id=d0f68544-8c3e-4e57-a9d5-72e32bbd9f15
2025-05-05 18:04:48,438 [INFO] email_processor: Mail sending is disabled. Skipping batch d0f68544-8c3e-4e57-a9d5-72e32bbd9f15
2025-05-05 18:04:48,496 [INFO] email_processor: Generated unique filename: AI_Agent_Data_Load_20250505_180448_2bbd9f15_20250505_180448_1c83458c.xlsx to prevent overwrites
2025-05-05 18:04:48,497 [INFO] email_processor: Connecting to SFTP server sftp.abc-amega.com:22 with username Sanskar
2025-05-05 18:04:50,121 [INFO] email_processor: Opening SFTP session for AI_Agent_Data_Load_20250505_180448_2bbd9f15.xlsx
2025-05-05 18:04:50,871 [INFO] email_processor: Uploading file AI_Agent_Data_Load_20250505_180448_2bbd9f15.xlsx to AI_Agent_Data_Load_20250505_180448_2bbd9f15_20250505_180448_1c83458c.xlsx via SFTP
2025-05-05 18:04:52,147 [INFO] email_processor: Successfully uploaded AI_Agent_Data_Load_20250505_180448_2bbd9f15.xlsx to SFTP server as AI_Agent_Data_Load_20250505_180448_2bbd9f15_20250505_180448_1c83458c.xlsx
2025-05-05 18:04:52,149 [INFO] email_processor: Excel file exported and uploaded: AI_Agent_Data_Load_20250505_180448_2bbd9f15.xlsx
2025-05-05 18:04:52,150 [INFO] email_processor: Batch d0f68544-8c3e-4e57-a9d5-72e32bbd9f15 completed in 8.1s: 3 processed, 0 failed, 3 drafts
2025-05-05 18:04:52,150 [INFO] email_processor: Batch complete. Next batch in 591.9 seconds
2025-05-05 18:05:32,849 [INFO] email_processor: System shutdown requested (KeyboardInterrupt)
2025-05-05 18:05:32,851 [INFO] email_processor: === Email Processing System Shutdown ===
